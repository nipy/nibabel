<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Neuroimaging in Python &#8212; NiBabel 5.4.0.dev1+g3b1c7b37 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/nibabel.css?v=f6107aeb" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=fd3f3429" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <script src="../../_static/documentation_options.js?v=8f87c9ba"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="BIAP8 - Always load image data as floating point" href="biap_0008.html" />
    <link rel="prev" title="BIAP6 - Identifying image axes" href="biap_0006.html" />
  <meta name="keywords" content="nipy, neuroimaging, python, neuroscience">

  </head><body>
<div class="row" style="display: flex; flex-direction: row; flex-wrap: wrap; width: 100%;">
  <div class="column" style="background-color: white; display: flex; flex-direction: column; flex: 0 0 140px; padding-left: 2px; padding-bottom:2px; padding-top:2px;">
    <img src="../../_static/nibabel-logo.svg" class="logo" alt="Logo" width="130px"/>
  </div>
  <div class="column" style="background-color: white; text-align: left; padding-left: 10px; padding-bottom:50px; padding-top:20px; background-repeat: no-repeat; display: flex; flex-direction: column; flex-basis: 100%; flex: 1;">
    <h1>NiBabel</h1>
    <h3 style="margin-top:-5px;color:#2f83c8">Access a cacophony of neuro-imaging file formats</h3>
  </div>
</div>

    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="biap_0008.html" title="BIAP8 - Always load image data as floating point"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="biap_0006.html" title="BIAP6 - Identifying image axes"
             accesskey="P">previous</a> |</li>
  <li><a href="http://nipy.org/">Community</a> |&nbsp;</li>
  <li><a href="../../index.html">NiBabel Home</a> |&nbsp;</li>
  <li><a href="https://mail.python.org/mailman/listinfo/neuroimaging">Mailing list</a> |&nbsp;</li>
  <li><a href="legal.html">License</a> |&nbsp;</li>

          <li class="nav-item nav-item-1"><a href="../index.html" >Developer documentation page</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">BIAPs</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Neuroimaging in Python</a></li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">BIAP7 - Loading multiple images</a><ul>
<li><a class="reference internal" href="#background">Background</a><ul>
<li><a class="reference internal" href="#some-formats-store-images-with-different-shapes-in-the-same-file">Some formats store images with different shapes in the same file</a></li>
<li><a class="reference internal" href="#it-can-be-useful-to-load-4d-images-as-multiple-3d-images">It can be useful to load 4D images as multiple 3D images</a></li>
</ul>
</li>
<li><a class="reference internal" href="#options">Options</a></li>
<li><a class="reference internal" href="#return-an-image-sequence-from-load-for-some-file-formats">Return an image sequence from <code class="docutils literal notranslate"><span class="pre">load</span></code> for some file formats</a></li>
<li><a class="reference internal" href="#add-a-load-multi-top-level-function">Add a <code class="docutils literal notranslate"><span class="pre">load_multi</span></code> top-level function</a></li>
<li><a class="reference internal" href="#next-steps">Next steps:</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="biap_0006.html"
                          title="previous chapter">BIAP6 - Identifying image axes</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="biap_0008.html"
                          title="next chapter">BIAP8 - Always load image data as floating point</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/devel/biaps/biap_0007.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="biap7-loading-multiple-images">
<span id="biap7"></span><h1>BIAP7 - Loading multiple images<a class="headerlink" href="#biap7-loading-multiple-images" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Author<span class="colon">:</span></dt>
<dd class="field-odd"><p>Matthew Brett</p>
</dd>
<dt class="field-even">Status<span class="colon">:</span></dt>
<dd class="field-even"><p>Draft</p>
</dd>
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Standards</p>
</dd>
<dt class="field-even">Created<span class="colon">:</span></dt>
<dd class="field-even"><p>2015-07-18</p>
</dd>
</dl>
<section id="background">
<h2>Background<a class="headerlink" href="#background" title="Link to this heading">¶</a></h2>
<section id="some-formats-store-images-with-different-shapes-in-the-same-file">
<h3>Some formats store images with different shapes in the same file<a class="headerlink" href="#some-formats-store-images-with-different-shapes-in-the-same-file" title="Link to this heading">¶</a></h3>
<p>The ECAT file format can contain more than one type of image in a single image
file.</p>
<p>ECAT can store many <em>frames</em> in a single image file.  Each frame has its own
<em>subheader</em>.   The subheader specifies the 3D image size; each frame can
therefore have a different image size.</p>
<p>We currently raise an error if you try and load an ECAT file where the frames
do not have the same 3D dimensions.</p>
<p>It would be better if we could allow loading multiple images with different
image dimensions, from a single ECAT file.</p>
<p><a class="reference external" href="http://www.cs.ubc.ca/labs/lci/vista/file.html">Vista data format</a> and <a class="reference external" href="http://static.cbs.mpg.de/lipsia/START/index3.html">Lipsia format</a> are other formats that allow saving
multiple images with different image dimensions in the same file.  We don’t
currently support Lipsia or Vista formats and it is not clear how we would do
that with the current <code class="docutils literal notranslate"><span class="pre">load</span></code> API.</p>
<p>We have had some discussion about saving multiple images into a
single HDF5 file - see <a class="reference external" href="https://github.com/nipy/nibabel/pull/215#issuecomment-122357444">https://github.com/nipy/nibabel/pull/215#issuecomment-122357444</a></p>
</section>
<section id="it-can-be-useful-to-load-4d-images-as-multiple-3d-images">
<h3>It can be useful to load 4D images as multiple 3D images<a class="headerlink" href="#it-can-be-useful-to-load-4d-images-as-multiple-3d-images" title="Link to this heading">¶</a></h3>
<p>We sometimes want to load a 4D image as multiple 3D images.</p>
<p>When we are doing motion correction, we often want to split up a 4D image into
separate 3D images.</p>
<p>Motion estimation results in different affines for each volume in the 4D time
series.  At the moment we have no API for returning these affines with a 4D
image.  One way of doing that is to load the 4D image and affines as a
sequence of 3D images, each with their own affine.</p>
<p>We currently have a proposal open for a JSON header extension that can store
these 4D affines for a 4D NIfTI file.</p>
<p>SPM saves the affines in an associated <code class="docutils literal notranslate"><span class="pre">.mat</span></code> file, with one affine per
volume in the 4D image.</p>
</section>
</section>
<section id="options">
<h2>Options<a class="headerlink" href="#options" title="Link to this heading">¶</a></h2>
</section>
<section id="return-an-image-sequence-from-load-for-some-file-formats">
<h2>Return an image sequence from <code class="docutils literal notranslate"><span class="pre">load</span></code> for some file formats<a class="headerlink" href="#return-an-image-sequence-from-load-for-some-file-formats" title="Link to this heading">¶</a></h2>
<p>We don’t currently load ECAT files from the top-level <code class="docutils literal notranslate"><span class="pre">nibabel.load</span></code>
function.</p>
<p>We do have <code class="docutils literal notranslate"><span class="pre">nibabel.ecat.load</span></code>, which raises an error for an ECAT file
having frames with different image dimensions.</p>
<p>We could therefore choose to return a sequence of images from <code class="docutils literal notranslate"><span class="pre">nibabel.load</span></code>
on an ECAT file, with one element per frame in the ECAT file.</p>
<p>Most ECAT images are 4D images, in the sense that the frames in the file do
all have the same image dimensions and data type, so this might be cumbersome
as a default.</p>
<p>We would have to work out how to deal with <code class="docutils literal notranslate"><span class="pre">nibabel.ecat.load</span></code>.</p>
<p>The same principles apply to the Lipsia / Vista formats, except we have no
backward-compatibility problems, and it seems to be more common for these
formats to mix image types in a single file.</p>
</section>
<section id="add-a-load-multi-top-level-function">
<h2>Add a <code class="docutils literal notranslate"><span class="pre">load_multi</span></code> top-level function<a class="headerlink" href="#add-a-load-multi-top-level-function" title="Link to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">nibabel.load_multi</span></code> always returns an image sequence.</p>
<p><code class="docutils literal notranslate"><span class="pre">nibabel.load</span></code> always returns a single image.</p>
<p><code class="docutils literal notranslate"><span class="pre">nibabel.load</span></code> on ECAT (etc) files could first do <code class="docutils literal notranslate"><span class="pre">load_multi</span></code>, then check
the resulting image dimensions, raising an error if incompatible,
concatenating otherwise.</p>
<p><code class="docutils literal notranslate"><span class="pre">load_multi</span></code> on current formats like NIfTI could return one image per
volume, where each volume might have its own affine, as loaded from the JSON
header extension or the SPM <code class="docutils literal notranslate"><span class="pre">.mat</span></code> file.</p>
</section>
<section id="next-steps">
<h2>Next steps:<a class="headerlink" href="#next-steps" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Make sure there are use-cases where you could wish to call <cite>load</cite> vs. <cite>load_multi</cite> on the same image (perhaps a Nifti image with different affines for each volume)</p></li>
<li><p>Investigate AFNI file formats as a use-case for this.</p></li>
<li><p>Check the <cite>nilearn</cite> codebase, see if <cite>iter_img</cite> and <cite>slice_img</cite> functions might offer a post-<cite>load</cite> alternative. Also check if those functions could be deprecated in favor of slicing / iterating on <cite>dataobj</cite></p></li>
<li><p>Create a new issue to implement getting an iterator on <cite>dataobj</cite>?</p></li>
</ul>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2006, NiBabel developers &lt;neuroimaging@python.org&gt;.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.0.2.
    </div>
  </body>
</html>